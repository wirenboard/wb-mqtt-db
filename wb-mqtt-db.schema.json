{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "title": "MQTT History Configuration",

  "properties": {
    "debug": {
      "type": "boolean",
      "title": "Enable debug logging",
      "default": false,
      "_format": "checkbox",
      "propertyOrder": 1
    },

    "request_timeout": {
        "type": "integer",
        "title": "Default request timeout (s)",
        "description": "Maximum time to process data request (if no such data in RPC request)",
        "propertyOrder": 2,
        "minimum": 0,
        "default": 9
    },

    "groups" : {
        "type" : "array",
        "title" : "Groups",
        "propertyOrder" : 3,

        "items" : {
            "type" : "object",
            "headerTemplate": "{{self.name}}",
            "title": "Group",

            "options" : {
              "disable_properties" : true,
              "disable_edit_json" : true,
              "compact": true,
              "disable_collapse": true,
              "wb": {
                "disable_panel": true
              }
            },

            "_format": "grid",

            "properties" : {
              "name": {
                "type": "string",
                "title": "Group name",
                "propertyOrder": 1,
                "minLength": 1,
                "options": {
                  "grid_columns": 12
                }
              },

              "channels" : {
                "type" : "array",
                "title" : "Channels",
                "_format" : "table",
                "propertyOrder" : 8,
                "items": { 
                "type" : "string",
                "title" : "Channel pattern",
                "minLength": 3,
                "options": {
                  "inputAttributes": {
                    "placeholder":  "device/channel"
                  }
                }
                },
                "options" : {
                  "disable_array_reorder" : true,
                  "disable_array_delete_last_row" : true,
                  "disable_array_delete_all_rows" : true,
                  "compact": true,
                  "grid_columns": 12
                }

              },

              "values" : {
                "type" : "integer",
                "title" : "Number of values to store, per channel",
                "propertyOrder" : 3,
                "default": 4000,
                "minimum" : 1,
                "options": {
                  "grid_columns": 6
                }
              },

              "values_total" : {
                "type" : "integer",
                "title" : "Number of values to store, per group",
                "propertyOrder" : 4,
                "default": 40000,
                "minimum" : 1,
                "options": {
                  "grid_columns": 6
                }
              },

              "min_interval" : {
                "type" : "number",
                "title" : "Minimum time interval between two data points (s)",
                "description" : "At most one value per specified time interval will be saved",
                "propertyOrder" : 5,
                "minimum" : 0,
                "default": 120,
                "options": {
                  "grid_columns": 6
                }
              },

              "min_unchanged_interval" : {
                "type" : "number",
                "title" : "Minimum time interval between two data points with the same value (s)",
                "propertyOrder" : 6,
                "minimum" : 0,
                "default": 1200,
                "options": {
                  "grid_columns": 6
                }
              },

              "max_burst" : {
                "type" : "number",
                "title" : "Maximum burst records count",
                "propertyOrder" : 7,
                "minimum" : 0,
                "options": {
                  "grid_columns": 12
                }
              }
          },
          "required": ["name", "channels"]
        },

        "_format": "tabs",

        "options": {
          "disable_array_reorder" : true,
          "disable_array_delete_last_row" : true,
          "disable_array_delete_all_rows" : true,
          "disable_collapse": true,
          "wb": {
            "disable_panel": true
          }
        }
    },
    "database" : {
        "type": "string",
        "title" : "DB file path",
        "default" : "/var/lib/wirenboard/db/data.db",
        "propertyOrder" : 3
    }    
  },

  "required": ["database", "groups"],

  "options": {
    "disable_collapse": true
  },

  "configFile": {
    "path": "/etc/wb-mqtt-db.conf",
    "service": "wb-mqtt-db"
  }
}
